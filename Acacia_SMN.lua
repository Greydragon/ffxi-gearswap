function get_sets()
    sets.perpetuation = {main='Chatoyant Staff', ammo='Eminent Sachet', head="Convoker's Horn", neck="Caller's Pendant", lear='Ruby Earring', rear='Moonshade Earring', body='Glyphic Doublet', hands='Adhara Gages', rring="Evoker's Ring", back='Conveyance Cape', waist='Mujin Obi', legs='Nares Trews', feet='Con. Pigaches +1'}
    sets.perpetuation['Carbuncle'] = {main='Chatoyant Staff', ammo='Eminent Sachet', head="Convoker's Horn", neck="Caller's Pendant", lear='Ruby Earring', rear='Moonshade Earring', body='Hagondes Coat +1', hands='Carbuncle Mitts', rring="Evoker's Ring", back='Conveyance Cape', waist='Mujin Obi', legs='Nares Trews', feet='Mdk. Crackows +1'}
    sets.perpetuation['Fenrir'] = {main='Chatoyant Staff', ammo='Eminent Sachet', head="Convoker's Horn", neck="Caller's Pendant", lear='Ruby Earring', rear='Moonshade Earring', body='Glyphic Doublet', hands='Glyphic Bracers +1', rring="Evoker's Ring", back='Conveyance Cape', waist='Mujin Obi', legs='Nares Trews', feet='Con. Pigaches +1'}
    sets.perpetuation['Garuda'] = {main='Vayuvata III', ammo='Eminent Sachet', head="Convoker's Horn", neck="Caller's Pendant", lear='Ruby Earring', rear='Moonshade Earring', body='Hagondes Coat +1', hands='Adhara Gages', rring="Evoker's Ring", back='Conveyance Cape', waist='Mujin Obi', legs='Nares Trews', feet='Con. Pigaches +1'}
    sets.perpetuation['Ramuh'] = {main='Apamajas III', ammo='Eminent Sachet', head="Convoker's Horn", neck="Caller's Pendant", lear='Ruby Earring', rear='Moonshade Earring', body='Hagondes Coat +1', hands='Adhara Gages', rring="Evoker's Ring", back='Conveyance Cape', waist='Mujin Obi', legs='Nares Trews', feet='Con. Pigaches +1'}
    sets.favor = {main='Chatoyant Staff', sub='Vox Grip', ammo='Eminent Sachet', head="Caller's Horn +2", neck="Caller's Pendant", lear='Smn. Earring', rear='Moonshade Earring', body='Call. Doublet +2', hands='Glyphic Bracers +1', lring='Fervor Ring', rring="Evoker's Ring", back='Conveyance Cape', waist='Cimmerian Sash', legs='Nares Trews', feet='Con. Pigaches +1'}
    sets.spirit = {main='Chatoyant Staff', sub='Vox Grip', ammo='Eminent Sachet', head="Convoker's Horn", neck="Caller's Pendant", lear='Smn. Earring', rear='Moonshade Earring', body='Call. Doublet +2', hands='Glyphic Bracers +1', lring='Fervor Ring', rring="Evoker's Ring", back='Conveyance Cape', waist='Cimmerian Sash', legs='Glyphic Spats', feet='Mdk. Crackows +1'}
    sets.resting = {main='Chatoyant Staff', ammo='Mana Ampulla', head="Convoker's Horn", neck='Eidolon Pendant', lear='Magnetic Earring', rear='Relaxing Earring', body='Hagondes Coat +1', hands='Nares Cuffs', back='Vita Cape', waist='Hierarch Belt', legs='Nares Trews', feet='Chelona Boots'}
    sets.idle = {head="Convoker's Horn", rear='Moonshade Earring', body='Hagondes Coat +1', legs='Nares Trews'}
    sets.speed = {legs='Tatsu. Sitagoromo'}

    sets.precast = {}
    sets.precast.delay = {ammo='Eminent Sachet', head="Convoker's Horn", body='Glyphic Doublet', hands='Glyphic Bracers +1', back="Tiresias' Cape", feet='Glyph. Pigaches +1'}
    sets.precast.cede = {hands='Call. Bracers +2'}
    sets.precast.siphon = {sub='Vox Grip', ammo='Eminent Sachet', head="Convoker's Horn", neck="Caller's Pendant", lear='Smn. Earring', rear='Gifted Earring', body='Anhur Robe', hands='Glyphic Bracers +1', lring='Fervor Ring', rring="Evoker's Ring", back='Conveyance Cape', waist='Cimmerian Sash', legs='Tatsu. Sitagoromo', feet="Caller's Pgch. +2"}

    sets.midcast = {}
    sets.midcast.cure = {main='Teiwaz', head="Marduk's Tiara +1", neck="Colossus's Torque", lear='Magnetic Earring', rear='Beatific Earring', body='Chelona Blazer', hands='Bokwus Gloves', back='Vita Cape', legs='Nares Trews'}
    sets.midcast.stoneskin = {neck='Stone Gorget', lear='Magnetic Earring', rear='Earthcry Earring', back='Vita Cape', waist='Siegel Sash', legs='Shedir Seraweels'}
    sets.midcast.regen = {head="Marduk's Tiara +1"}

    sets.pet_midcast = {}
    sets.pet_midcast.physical = {sub='Vox Grip', ammo='Eminent Sachet', head="Convoker's Horn", neck='Sacrifice Torque', lear='Ruby Earring', rear='Gifted Earring', body='Con. Doublet +1', hands='Glyphic Bracers +1', lring='Fervor Ring', rring="Evoker's Ring", back='Conveyance Cape', waist='Mujin Obi', legs='Ngen Seraweels', feet='Con. Pigaches +1'}
    sets.pet_midcast.magic = {main='Astralwatcher', sub='Vox Grip', ammo='Eminent Sachet', head='Glyphic Horn', neck='Eidolon Pendant', lear='Smn. Earring', rear='Gifted Earring', body='Con. Doublet +1', hands='Nares Cuffs', lring='Fervor Ring', rring="Evoker's Ring", back="Tiresias' Cape", waist="Caller's Sash", legs="Ngen Seraweels", feet='Hagondes Sabots'}
    sets.pet_midcast.magic.tp = {main='Astralwatcher', sub='Vox Grip', ammo='Eminent Sachet', head='Glyphic Horn', neck='Eidolon Pendant', lear='Smn. Earring', rear='Gifted Earring', body='Con. Doublet +1', hands='Nares Cuffs', lring='Fervor Ring', rring="Evoker's Ring", back="Tiresias' Cape", waist="Caller's Sash", legs="Caller's Spats +2", feet='Hagondes Sabots'}
    sets.pet_midcast.accuracy = {sub='Vox Grip', ammo='Eminent Sachet', head="Convoker's Horn", neck="Caller's Pendant", lear='Smn. Earring', rear='Gifted Earring', body='Anhur Robe', hands='Glyphic Bracers +1', lring='Fervor Ring', rring="Evoker's Ring", back='Conveyance Cape', waist='Cimmerian Sash', legs='Glyphic Spats', feet='Mdk. Crackows +1'}
    sets.pet_midcast.duration = {sub='Vox Grip', head="Convoker's Horn", neck="Caller's Pendant", lear='Smn. Earring', rear='Gifted Earring', hands='Glyphic Bracers +1', lring='Fervor Ring', rring="Evoker's Ring", back='Conveyance Cape', waist="Jaq'ij Sash"}
    sets.pet_midcast.boon = {rear='Gifted Earring', waist="Jaq'ij Sash", legs="Caller's Spats +2"}
    sets.pet_midcast.skill = {sub='Vox Grip', head="Convoker's Horn", neck="Caller's Pendant", lear='Smn. Earring', rear='Gifted Earring', body='Anhur Robe', hands='Glyphic Bracers +1', lring='Fervor Ring', rring="Evoker's Ring", back='Conveyance Cape', waist='Cimmerian Sash', legs='Mdk. Shalwar +1', feet='Mdk. Crackows +1'}

    bp_physical = {['Regal Scratch']=true, ['Punch']=true, ['Rock Throw']=true, ['Barracuda Dive']=true, ['Claw']=true, ['Axe Kick']=true, ['Shock Strike']=true, ['Camisado']=true, ['Poison Nails']=true, ['Moonlit Charge']=true, ['Crescent Fang']=true, ['Rock Buster']=true, ['Tail Whip']=true, ['Double Punch']=true, ['Megalith Throw']=true, ['Double Slap']=true, ['Eclipse Bite']=true, ['Mountain Buster']=true, ['Spinning Dive']=true, ['Predator Claws']=true, ['Rush']=true, ['Chaotic Strike']=true}
    bp_hybrid = {['Burning Strike']=true, ['Flaming Crush']=true}
    bp_magic = {['Inferno']=true, ['Earthen Fury']=true, ['Tidal Wave']=true, ['Aerial Blast']=true, ['Diamond Dust']=true, ['Judgment Bolt']=true, ['Searing Light']=true, ['Howling Moon']=true, ['Ruinous Omen']=true, ['Zantetsuken']=true, ['Somnolence']=true, ['Nether Blast']=true, ['Fire II']=true, ['Stone II']=true, ['Water II']=true, ['Aero II']=true, ['Blizzard II']=true, ['Thunder II']=true, ['Fire IV']=true, ['Stone IV']=true, ['Water IV']=true, ['Aero IV']=true, ['Blizzard IV']=true, ['Thunder IV']=true, ['Thunderspark']=true, ['Meteorite']=true, ['Holy Mist']=true, ['Lunar Bay']=true, ['Night Terror']=true, ['Level ? Holy']=true}
    bp_magic_tp = {['Meteor Strike']=true, ['Geocrush']=true, ['Grand Fall']=true, ['Wind Blade']=true, ['Heavenly Strike']=true, ['Thunderstorm']=true}
    bp_accuracy = {['Mewing Lullaby']=true, ['Eerie Eye']=true, ['Lunar Cry']=true, ['Nightmare']=true, ['Lunar Roar']=true, ['Slowga']=true, ['Ultimate Terror']=true, ['Sleepga']=true, ['Tidal Roar']=true, ['Diamond Storm']=true, ['Shock Squall']=true, ['Pavor Nocturnus']=true}
    bp_duration = {['Glittering Ruby']=true, ['Shining Ruby']=true, ['Frost Armor']=true, ['Rolling Thunder']=true, ['Crimson Howl']=true, ['Lightning Armor']=true, ['Ecliptic Growl']=true, ['Hastega']=true, ['Noctoshield']=true, ['Ecliptic Howl']=true, ['Dream Shroud']=true, ['Earthen Armor']=true, ['Fleet Wind']=true, ['Heavenward Howl']=true}
    bp_boon = {['Earthen Ward']=true, ['Aerial Armor']=true, ['Raise II']=true, ['Reraise II']=true, ['Healing Ruby']=true, ['Whispering Wind']=true, ['Spring Water']=true, ['Healing Ruby II']=true}
    bp_skill = {['Perfect Defense']=true, ['Inferno Howl']=true, ['Soothing Ruby']=true}

    spirit_element = {['Fire']='Fire Spirit', ['Earth']='Earth Spirit', ['Water']='Water Spirit', ['Wind']='Air Spirit', ['Ice']='Ice Spirit', ['Lightning']='Thunder Spirit', ['Light']='Light Spirit', ['Dark']='Dark Spirit'}
    spirit_conflict = {['Fire']='Ice', ['Earth']='Lightning', ['Water']='Fire', ['Wind']='Earth', ['Ice']='Wind', ['Lightning']='Water', ['Light']='Dark', ['Dark']='Light'}
end

function buff_change(name, gain)
    if name == "Avatar's Favor" then
        if gain then
            equip(sets.favor)
        else
            equip(sets.perpetuation[pet.name] or sets.perpetuation)
        end
    end
end

function pet_change(pet, gain)
    if gain then
        if pet.name:find('Spirit') then
            equip(sets.spirit)
        elseif buffactive["Avatar's Favor"] then
            equip(sets.favor)
        else
            equip(sets.perpetuation[pet.name] or sets.perpetuation)
        end
    else
        equip(sets.idle)
    end
end

function status_change(new, old)
    if pet.isvalid == false then
        if new == 'Idle' then
            equip(sets.idle)
        elseif new == 'Resting' then
            equip(sets.resting)
        end
    end
end

function precast(spell)
    if pet.isvalid then
        if spell.type == 'BloodPactRage' or spell.type == 'BloodPactWard' then
            equip(sets.precast.delay)
        elseif spell.name == 'Elemental Siphon' then
            equip(sets.precast.siphon)
        elseif spell.name == 'Mana Cede' then
            equip(sets.precast.cede)
        end
    elseif spell.name == 'Dark Spirit' then
        if world.weather_element == 'Dark' then
            return
        elseif world.weather_element ~= 'None' and spirit_conflict[world.day_element] ~= world.weather_element then
            cancel_spell()
            windower.send_command('input /ma "%s" <me>':format(spirit_element[world.weather_element]))
        elseif world.day_element == 'Dark' then
            return
        else
            cancel_spell()
            windower.send_command('input /ma "%s" <me>':format(spirit_element[world.day_element]))
        end
    elseif spell.name == 'Sneak' then
        windower.ffxi.cancel_buff(71)
    elseif spell.name == 'Stoneskin' then
        windower.ffxi.cancel_buff(37)
    end
end

function midcast(spell)
    if spell.name == 'Stoneskin' then
        equip(sets.midcast.stoneskin)
    elseif spell.name:find('Cure') then
        equip(sets.midcast.cure)
    elseif spell.name:find('Regen') then
        equip(sets.midcast.regen)
    end
end

function pet_midcast(spell)
    if spell.type == 'BloodPactRage' or spell.type == 'BloodPactWard' then
        if bp_physical[spell.name] then
            equip(sets.pet_midcast.physical)
        elseif bp_magic_tp[spell.name] then
            if pet.tp < 140 then
                equip(sets.pet_midcast.magic.tp)
            else
                equip(sets.pet_midcast.magic)
            end
        elseif bp_magic[spell.name] or bp_hybrid[spell.name] then
            equip(sets.pet_midcast.magic)
        elseif bp_accuracy[spell.name] then
            equip(sets.pet_midcast.accuracy)
        elseif bp_duration[spell.name] then
            equip(sets.pet_midcast.duration)
        elseif bp_boon[spell.name] then
            equip(sets.pet_midcast.boon)
        elseif bp_skill[spell.name] then
            equip(sets.pet_midcast.skill)
        end
    end
end

function aftercast(spell)
    if spell.type == 'WhiteMagic' or spell.name == 'Elemental Siphon' or spell.name == 'Mana Cede' then
        if pet.isvalid then
            if pet.name:find('Spirit') then
                equip(sets.spirit)
            elseif buffactive["Avatar's Favor"] then
                equip(sets.favor)
            else
                equip(sets.perpetuation[pet.name] or sets.perpetuation)
            end
        else
            equip(sets.idle)
        end
    end
end

function pet_aftercast(spell)
    if pet.name:find('Spirit') then
        equip(sets.spirit)
    elseif buffactive["Avatar's Favor"] then
        equip(sets.favor)
    else
        equip(sets.perpetuation[pet.name] or sets.perpetuation)
    end
end
